"use strict";

var brandBestObj = {
	divArea: jQuery("#${cpntConfig.dispSpceId}"),
	data : [{"dispPageCtgrNo":"59385","dispCtgrNo":"59411","dispSpceNo":154616246,"dispCtgrNm":"네파","dispObjectNm":"","imageUrl":"http://i.011st.com/browsing/banner/2014/02/13/100104/2014021317501325759_59411.jpg","imageLink":"","dtMstrCd":"9r","dispSpceId":"DT_59385_20806","dtMstrId":"OUTDOOR","dtPrdDomainRelList":[{"dispSpceNo":154616246,"prdNo":889364858,"prdNm":"(QA_김은경)XSS 테스트_meta","prdNmEng":"","brandNm":"","prdImg":"/z/3/6/4/8/5/8/889364858_B.jpg","finalDscPrc":"10,000","selPrc":"10,000","isFreeDlvCd":true,"isDiscount":false,"prdImgMap":{"100":"http://i.011st.com/ex_t/R/100x100/1/85/1/src/z/3/6/4/8/5/8/889364858_B.jpg","300":"http://i.011st.com/ex_t/R/300x300/1/85/1/src/z/3/6/4/8/5/8/889364858_B.jpg"},"prdNoImgMap":{"100":"this.src\u003d\u0027http://i.011st.com/ex_t/R/100x100/1/85/1/src/img/product/no_image.gif\u0027","300":"this.src\u003d\u0027http://i.011st.com/ex_t/R/300x300/1/85/1/src/img/product/no_image.gif\u0027"},"imgSizeList":[100,300],"imgCut":1,"favorShopRt":0,"favorShopAmt":0,"buySatisfy":0,"sellerHmpgNm":"eunkunglover","selMnbdNo":23253938,"memId":"ekkim14","memNickNm":"eunkunglover","discountRate":0,"dtMstrCd":"9r","dispCtgrNo":"59385","dispSpceId":"DT_59385_20806","clickScript":"stat.track(\u0027154616246\u0027,\u0027DT\u0027,\u002759385\u0027); dtTrc.goPrd(\u0027889364858\u0027,\u0027\u0027); return false;","shpLikeCnt":0},{"dispSpceNo":154616246,"prdNo":889364858,"prdNm":"(QA_김은경)XSS 테스트_meta","prdNmEng":"","brandNm":"","prdImg":"/z/3/6/4/8/5/8/889364858_B.jpg","finalDscPrc":"10,000","selPrc":"10,000","isFreeDlvCd":true,"isDiscount":false,"prdImgMap":{"100":"http://i.011st.com/ex_t/R/100x100/1/85/1/src/z/3/6/4/8/5/8/889364858_B.jpg","300":"http://i.011st.com/ex_t/R/300x300/1/85/1/src/z/3/6/4/8/5/8/889364858_B.jpg"},"prdNoImgMap":{"100":"this.src\u003d\u0027http://i.011st.com/ex_t/R/100x100/1/85/1/src/img/product/no_image.gif\u0027","300":"this.src\u003d\u0027http://i.011st.com/ex_t/R/300x300/1/85/1/src/img/product/no_image.gif\u0027"},"imgSizeList":[100,300],"imgCut":1,"favorShopRt":0,"favorShopAmt":0,"buySatisfy":0,"sellerHmpgNm":"eunkunglover","selMnbdNo":23253938,"memId":"ekkim14","memNickNm":"eunkunglover","discountRate":0,"dtMstrCd":"9r","dispCtgrNo":"59385","dispSpceId":"DT_59385_20806","clickScript":"stat.track(\u0027154616246\u0027,\u0027DT\u0027,\u002759385\u0027); dtTrc.goPrd(\u0027889364858\u0027,\u0027\u0027); return false;","shpLikeCnt":0}]},{"dispPageCtgrNo":"59385","dispCtgrNo":"59411","dispSpceNo":154616246,"dispCtgrNm":"컬럼비아","dispObjectNm":"","imageUrl":"http://i.011st.com/browsing/banner/2014/02/13/100104/2014021317501325759_59411.jpg","imageLink":"","dtMstrCd":"9r","dispSpceId":"DT_59385_20806","dtMstrId":"OUTDOOR","dtPrdDomainRelList":[{"dispSpceNo":154616246,"prdNo":889364858,"prdNm":"(QA_김은경)XSS 테스트_meta","prdNmEng":"","brandNm":"","prdImg":"/z/3/6/4/8/5/8/889364858_B.jpg","finalDscPrc":"10,000","selPrc":"10,000","isFreeDlvCd":true,"isDiscount":false,"prdImgMap":{"100":"http://i.011st.com/ex_t/R/100x100/1/85/1/src/z/3/6/4/8/5/8/889364858_B.jpg","300":"http://i.011st.com/ex_t/R/300x300/1/85/1/src/z/3/6/4/8/5/8/889364858_B.jpg"},"prdNoImgMap":{"100":"this.src\u003d\u0027http://i.011st.com/ex_t/R/100x100/1/85/1/src/img/product/no_image.gif\u0027","300":"this.src\u003d\u0027http://i.011st.com/ex_t/R/300x300/1/85/1/src/img/product/no_image.gif\u0027"},"imgSizeList":[100,300],"imgCut":1,"favorShopRt":0,"favorShopAmt":0,"buySatisfy":0,"sellerHmpgNm":"eunkunglover","selMnbdNo":23253938,"memId":"ekkim14","memNickNm":"eunkunglover","discountRate":0,"dtMstrCd":"9r","dispCtgrNo":"59385","dispSpceId":"DT_59385_20806","clickScript":"stat.track(\u0027154616246\u0027,\u0027DT\u0027,\u002759385\u0027); dtTrc.goPrd(\u0027889364858\u0027,\u0027\u0027); return false;","shpLikeCnt":0},{"dispSpceNo":154616246,"prdNo":889364858,"prdNm":"(QA_김은경)XSS 테스트_meta","prdNmEng":"","brandNm":"","prdImg":"/z/3/6/4/8/5/8/889364858_B.jpg","finalDscPrc":"10,000","selPrc":"10,000","isFreeDlvCd":true,"isDiscount":false,"prdImgMap":{"100":"http://i.011st.com/ex_t/R/100x100/1/85/1/src/z/3/6/4/8/5/8/889364858_B.jpg","300":"http://i.011st.com/ex_t/R/300x300/1/85/1/src/z/3/6/4/8/5/8/889364858_B.jpg"},"prdNoImgMap":{"100":"this.src\u003d\u0027http://i.011st.com/ex_t/R/100x100/1/85/1/src/img/product/no_image.gif\u0027","300":"this.src\u003d\u0027http://i.011st.com/ex_t/R/300x300/1/85/1/src/img/product/no_image.gif\u0027"},"imgSizeList":[100,300],"imgCut":1,"favorShopRt":0,"favorShopAmt":0,"buySatisfy":0,"sellerHmpgNm":"eunkunglover","selMnbdNo":23253938,"memId":"ekkim14","memNickNm":"eunkunglover","discountRate":0,"dtMstrCd":"9r","dispCtgrNo":"59385","dispSpceId":"DT_59385_20806","clickScript":"stat.track(\u0027154616246\u0027,\u0027DT\u0027,\u002759385\u0027); dtTrc.goPrd(\u0027889364858\u0027,\u0027\u0027); return false;","shpLikeCnt":0}]},
	        {"dispPageCtgrNo":"59385","dispCtgrNo":"59411","dispSpceNo":154616246,"dispCtgrNm":"아이더","dispObjectNm":"","imageUrl":"http://i.011st.com/browsing/banner/2014/02/13/100104/2014021317501325759_59411.jpg","imageLink":"","dtMstrCd":"9r","dispSpceId":"DT_59385_20806","dtMstrId":"OUTDOOR","dtPrdDomainRelList":[{"dispSpceNo":154616246,"prdNo":889364858,"prdNm":"(QA_김은경)XSS 테스트_meta","prdNmEng":"","brandNm":"","prdImg":"/z/3/6/4/8/5/8/889364858_B.jpg","finalDscPrc":"10,000","selPrc":"10,000","isFreeDlvCd":true,"isDiscount":false,"prdImgMap":{"100":"http://i.011st.com/ex_t/R/100x100/1/85/1/src/z/3/6/4/8/5/8/889364858_B.jpg","300":"http://i.011st.com/ex_t/R/300x300/1/85/1/src/z/3/6/4/8/5/8/889364858_B.jpg"},"prdNoImgMap":{"100":"this.src\u003d\u0027http://i.011st.com/ex_t/R/100x100/1/85/1/src/img/product/no_image.gif\u0027","300":"this.src\u003d\u0027http://i.011st.com/ex_t/R/300x300/1/85/1/src/img/product/no_image.gif\u0027"},"imgSizeList":[100,300],"imgCut":1,"favorShopRt":0,"favorShopAmt":0,"buySatisfy":0,"sellerHmpgNm":"eunkunglover","selMnbdNo":23253938,"memId":"ekkim14","memNickNm":"eunkunglover","discountRate":0,"dtMstrCd":"9r","dispCtgrNo":"59385","dispSpceId":"DT_59385_20806","clickScript":"stat.track(\u0027154616246\u0027,\u0027DT\u0027,\u002759385\u0027); dtTrc.goPrd(\u0027889364858\u0027,\u0027\u0027); return false;","shpLikeCnt":0},{"dispSpceNo":154616246,"prdNo":889364858,"prdNm":"(QA_김은경)XSS 테스트_meta","prdNmEng":"","brandNm":"","prdImg":"/z/3/6/4/8/5/8/889364858_B.jpg","finalDscPrc":"10,000","selPrc":"10,000","isFreeDlvCd":true,"isDiscount":false,"prdImgMap":{"100":"http://i.011st.com/ex_t/R/100x100/1/85/1/src/z/3/6/4/8/5/8/889364858_B.jpg","300":"http://i.011st.com/ex_t/R/300x300/1/85/1/src/z/3/6/4/8/5/8/889364858_B.jpg"},"prdNoImgMap":{"100":"this.src\u003d\u0027http://i.011st.com/ex_t/R/100x100/1/85/1/src/img/product/no_image.gif\u0027","300":"this.src\u003d\u0027http://i.011st.com/ex_t/R/300x300/1/85/1/src/img/product/no_image.gif\u0027"},"imgSizeList":[100,300],"imgCut":1,"favorShopRt":0,"favorShopAmt":0,"buySatisfy":0,"sellerHmpgNm":"eunkunglover","selMnbdNo":23253938,"memId":"ekkim14","memNickNm":"eunkunglover","discountRate":0,"dtMstrCd":"9r","dispCtgrNo":"59385","dispSpceId":"DT_59385_20806","clickScript":"stat.track(\u0027154616246\u0027,\u0027DT\u0027,\u002759385\u0027); dtTrc.goPrd(\u0027889364858\u0027,\u0027\u0027); return false;","shpLikeCnt":0}]}],
	currentTopIdx : 0,
	currentBottomIdx: 4,
	currentActIdx: 0,
	
	init : function() {
		var me = this;
		
		if(me.existCategoryData()) {
			var randomNumber = me.getRandomInt(0, 4);
			var $listArea = jQuery("#${cpntConfig.dispSpceId}_list", me.divArea);
			var totalDataSize = me.data.length;
			
			me.currentActIdx = randomNumber;
			me.existData();
			me.drawBanner(randomNumber);	
			me.bindEvent();
			me.beatUpButton($listArea, totalDataSize-1);
			me.beatDownButton($listArea, totalDataSize-1);
			me.changeSelectedBrandName(me.data[me.currentActIdx].dispCtgrNm);
		}
	},
	existCategoryData: function() {
		var me = this;
		
		if(me.data.length <= 4) {
			//me.divArea.parent().css("display","none");
			return false;
		}
		
		return true;
	},
	setCurrentActIdx: function(currentActIdx) {
		var me = this;
		me.currentActIdx = currentActIdx;
	},
	setDivArea: function(divAreaName) {
		var me = this;
		me.divArea = jQuery("#"+divAreaName);
	},
	setCurrentBottomIdx: function(currentBottomIdx) {
		var me = this;
		me.currentBottomIdx = currentBottomIdx;
	},
	setCurrentTopIdx: function(currentTopIdx) {
		var me = this;
		me.currentTopIdx = currentTopIdx;
	},
	beatDownButton: function($listArea, totalDataSize) {
		var me = this;
		
		jQuery(".in_next", me.divArea).click( function() {
			jQuery("#li"+me.currentTopIdx, $listArea).remove();
			
			var insertIdx = (me.currentBottomIdx == totalDataSize) ? 0 : me.currentBottomIdx+1;
			var category = me.data[insertIdx];
			var bannerHtml = new Array();
			
			me.makeBanner(bannerHtml, insertIdx, category, "", false);
			
			jQuery(jQuery("li[name=logo]", $listArea)[3]).after(bannerHtml.join(''));		
			
			me.currentTopIdx = (me.currentTopIdx == totalDataSize) ? 0 : me.currentTopIdx+1;
			me.currentBottomIdx = insertIdx;
			
			jQuery("#li"+me.currentActIdx, $listArea).removeClass("selected");
			me.currentActIdx = (me.currentActIdx == totalDataSize) ? 0 : parseInt(me.currentActIdx)+1;
			
			jQuery("#li"+me.currentActIdx, $listArea).addClass("selected");
			jQuery("#li"+me.currentActIdx, $listArea).find(".thumb_w100_f300").html(me.drawProduct(me.currentActIdx));
			
			me.changeSelectedBrandName(me.data[me.currentActIdx].dispCtgrNm);
		});
	},
	beatUpButton: function($listArea, totalDataSize) {
		var me = this;
		
		jQuery(".in_prev", me.divArea).click( function() {
			jQuery("#li"+me.currentBottomIdx, $listArea).remove();
			
			var insertIdx = (me.currentTopIdx == 0) ? totalDataSize : me.currentTopIdx-1;
			var category = me.data[insertIdx];
			var bannerHtml = new Array();
			
			me.makeBanner(bannerHtml, insertIdx, category, "", false);
			
			jQuery(jQuery("li[name=logo]", $listArea)[0]).before(bannerHtml.join(''));		
			
			me.currentTopIdx = insertIdx;
			me.currentBottomIdx = (me.currentBottomIdx == 0) ? totalDataSize : me.currentBottomIdx-1;
			
			jQuery("#li"+me.currentActIdx, $listArea).removeClass("selected");
			me.currentActIdx = (me.currentActIdx == 0) ? totalDataSize : me.currentActIdx-1;
			
			jQuery("#li"+me.currentActIdx, $listArea).addClass("selected");
			jQuery("#li"+me.currentActIdx, $listArea).find(".thumb_w100_f300").html(me.drawProduct(me.currentActIdx));
			
			me.changeSelectedBrandName(me.data[me.currentActIdx].dispCtgrNm);
		});
	},
	bindEvent: function() {
		var me = this;
		var $listArea = jQuery("#${cpntConfig.dispSpceId}_list", me.divArea);
		
		$listArea.delegate("li[name=logo]", "mouseover", function(evt) {
			jQuery(this).addClass("hover");
		}).delegate("li[name=logo]", "mouseleave", function(evt) {
			jQuery(this).removeClass("hover");
		}).delegate("li[name=logo]", "click", function(evt) {
			var idx = jQuery(this).attr("data-idx");
			jQuery(".selected", $listArea).removeClass("selected");
			jQuery("#li"+idx, $listArea).addClass("selected");
			jQuery("#li"+idx, $listArea).find(".thumb_w100_f300").html(me.drawProduct(idx));
			me.currentActIdx = idx;
			me.changeSelectedBrandName(me.data[me.currentActIdx].dispCtgrNm);
		}).delegate("#productMore", "click", function(evt) {
			var categoryNo = jQuery(this).attr("data-categoryNo");
			document.location.href = _ACTION_CONTEXT_URL_+'/disp/DTAction.tmall?ID=OUTDOOR&ctgrNo='+categoryNo;
		});
	},
	getRandomInt : function(min, max) {
		return Math.floor(Math.random() * (max - min + 1)) + min;		
	},
	existData: function() {
		var me = this;
		
		if(me.data.length < 5) {
			me.divArea.parent().css("display","none");
		}
	},
	drawBanner: function(randomNumber) {
		var me = this;
		var $listArea = jQuery("#${cpntConfig.dispSpceId}_list", me.divArea);
		var bannerHtml = new Array();
		var categorysObj = me.data;
		var maxViewCount = (categorysObj.length > 5) ? 5 : categorysObj.length;
		var category; 
		var liClass;
		var result;
		
		for(var i=0; i<maxViewCount; i++) {
			category = me.data[i];
			liClass = (i == randomNumber) ? 'class="selected"' : '';
	
			me.makeBanner(bannerHtml, i, category, liClass, true);
		}
		
		result = bannerHtml.join('');
		me.cacheProductData = result;
		$listArea.html(result);
	},
	makeBanner: function(bannerHtml, idx, categoryObj, liClass, isDrawProduct) {
		var me = this;
		
		bannerHtml.push('<li id="li'+idx+'" name="logo" '+liClass+' data-idx='+idx+'>');
		bannerHtml.push('	<a class="brand"><img src="'+categoryObj.imageUrl+'" alt="'+categoryObj.dispCtgrNm+'"></a>');
		bannerHtml.push('	<div class="cmp_prd_fl">');
		bannerHtml.push('       <h4><span id="selectedBrand"></span></h4>');
		bannerHtml.push('		<ul class="thumb_w100_f300">');
		
		if(isDrawProduct) {
			bannerHtml.push(me.drawProduct(idx));
		}
		
		bannerHtml.push('		</ul>');
		bannerHtml.push('		<a data-categoryNo="'+categoryObj.dispCtgrNo+'" id="productMore" class="defbtn_sm arrdtype6"><span>더 많은 상품보기</span></a>');
		bannerHtml.push('	</div>');
		bannerHtml.push('</li>');
	},
	changeSelectedBrandName: function(brandName) {
		var me = this;
		var $brandObj = jQuery("#selectedBrand", me.divArea);
		
		$brandObj.html(brandName);
	},
	drawProduct : function(categoryIdx) {
		var me = this;
		var productHtml = new Array();
		var productsObj = me.data[categoryIdx].dtPrdDomainRelList;
		var productDetailUrl = "/detail.jsp";
		var imagePath;
		var noImagePath;
		var liClass;
		var prd;
		
		for(var i=0; i<productsObj.length; i++) {
			prd = productsObj[i]; 
			liClass = (i == 0) ? 'class="prd_first"' : '';
			imagePath = (i == 0) ? prd.prdImgMap[300] : prd.prdImgMap[100];
			noImagePath = (i == 0) ? "<%=ImageUtil.getNoImageUrl(300)%>" : "<%=ImageUtil.getNoImageUrl(100)%>";
				
			productHtml.push('<li '+liClass+'>');
			productHtml.push('	<div class="pub_alignC">');
			productHtml.push('		<a href="'+productDetailUrl+prd.prdNo+'&trTypeCd='+prd.dtMstrCd+'&trCtgrNo='+prd.dispCtgrNo+'" >');
			productHtml.push('			<div class="pub_photo"><img src="'+imagePath+'" alt="'+prd.prdNm+'" onerror="this.src=\''+noImagePath+'\'"></div>');
			productHtml.push('			<div class="pub_info">');
			productHtml.push('				<em class="pub_title">'+prd.prdNm+'</em>');
			productHtml.push('				<div class="pub_priceW">');
			productHtml.push('					<s class="pub_price">'+prd.selPrc+'<span class="won">원</span></s><!--이전가격 없을경우 <s></s>삭제-->');
			productHtml.push('					<strong class="pub_salep">'+prd.finalDscPrc+'<span class="won">원</span></strong>');
			productHtml.push('				</div>');
			productHtml.push('				<div class="list_icoH">');
			
			if(prd.freeDlvCd === true) {
				productHtml.push('					<span class="ico_deliver1"><b>무료배송</b></span>');
			}
			
			if(prd.discountRate > 0) {
				productHtml.push('					<span class="ico_benefit1"><b>할인</b></span>');
			}
			
			productHtml.push('				</div>');
			productHtml.push('			</div>');
			productHtml.push('		</a>');
			productHtml.push('	</div>');
			productHtml.push('</li>');
		}
		
		return productHtml.join('');
	}
}